import{_ as a,c as i,o as n,ag as t}from"./chunks/framework.8SQNO8WI.js";const E=JSON.parse('{"title":"使用tailscale组网一些技巧","description":"","frontmatter":{},"headers":[],"relativePath":"计算机网络/使用tailscale组网一些技巧.md","filePath":"计算机网络/使用tailscale组网一些技巧.md","lastUpdated":1726751071000}'),p={name:"计算机网络/使用tailscale组网一些技巧.md"};function l(e,s,h,k,r,d){return n(),i("div",null,[...s[0]||(s[0]=[t(`<h1 id="使用tailscale组网一些技巧" tabindex="-1">使用tailscale组网一些技巧 <a class="header-anchor" href="#使用tailscale组网一些技巧" aria-label="Permalink to &quot;使用tailscale组网一些技巧&quot;">​</a></h1><h2 id="分布式部署系统" tabindex="-1">分布式部署系统 <a class="header-anchor" href="#分布式部署系统" aria-label="Permalink to &quot;分布式部署系统&quot;">​</a></h2><p>A电脑部署数据库， B电脑部署程序后端， 只需要将打包的程序的数据库链接字段的ip替换成hostname即可完成组网</p><h2 id="exitnode-模式" tabindex="-1">exitnode 模式 <a class="header-anchor" href="#exitnode-模式" aria-label="Permalink to &quot;exitnode 模式&quot;">​</a></h2><p>设置节点为exitnode模式，即可让节点直接通过exitnode访问外网</p><h2 id="subnet路由" tabindex="-1">subnet路由 <a class="header-anchor" href="#subnet路由" aria-label="Permalink to &quot;subnet路由&quot;">​</a></h2><p>可以直接使用这个子网路由支持persec的连接 被控端为192.168.234.0/24</p><p>使用这个命令暴露子网路由，并去网页勾选这个子网路由</p><div class="language-powershell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">powershell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> tailscale up </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">--</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">advertise</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">routes</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">192.168</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">234.0</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">24</span></span></code></pre></div><p>就可以使用persec直接控制了</p><h2 id="自建derp中继" tabindex="-1">自建derp中继 <a class="header-anchor" href="#自建derp中继" aria-label="Permalink to &quot;自建derp中继&quot;">​</a></h2><p>使用这个命令开启纯http服务</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./derper</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --hostname=你的域名</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --stun</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -http-port</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> :18181</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --verify-clients=true</span></span></code></pre></div><p>nginx 配置域名加上https</p><div class="language-text vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>server {</span></span>
<span class="line"><span>    # 服务器端口使用443，开启ssl, 这里ssl就是上面安装的ssl模块</span></span>
<span class="line"><span>    listen  443 ssl;</span></span>
<span class="line"><span>    # 域名，多个以空格分开</span></span>
<span class="line"><span>    server_name  你的域名;</span></span>
<span class="line"><span>    </span></span>
<span class="line"><span>    # ssl证书地址</span></span>
<span class="line"><span>    ssl_certificate     证书.pem;  # pem文件的路径</span></span>
<span class="line"><span>    ssl_certificate_key  证书.key; # key文件的路径</span></span>
<span class="line"><span>    </span></span>
<span class="line"><span>    location / {</span></span>
<span class="line"><span>        proxy_redirect off;</span></span>
<span class="line"><span>        proxy_pass http://127.0.0.1:18181; # port</span></span>
<span class="line"><span>        proxy_http_version 1.1;</span></span>
<span class="line"><span>        proxy_set_header Upgrade $http_upgrade;</span></span>
<span class="line"><span>        proxy_set_header Connection &quot;upgrade&quot;;</span></span>
<span class="line"><span>        proxy_set_header Host $host;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>        proxy_set_header X-Real-IP $remote_addr;</span></span>
<span class="line"><span>        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}</span></span></code></pre></div><p><a href="https://login.tailscale.com/admin/acls/file" target="_blank" rel="noreferrer">https://login.tailscale.com/admin/acls/file</a></p><p>ACL配置节点</p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">	&quot;derpMap&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">		&quot;OmitDefaultRegions&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">		&quot;Regions&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">			&quot;900&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">				&quot;RegionID&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:   </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">900</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">				&quot;RegionCode&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;xxx&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">				&quot;RegionName&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;xxx&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">				&quot;Nodes&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">					{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">						&quot;Name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:             </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">						&quot;RegionID&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:         </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">900</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">						&quot;HostName&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:         </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;你的域名&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">						&quot;DERPPort&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:         </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">443</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">						&quot;IPv4&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:             </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;你的服务器ip&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">						&quot;STUNPort&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:         </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3478</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">						&quot;InsecureForTests&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">					},</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">				],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">			},</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		},</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	},</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div>`,18)])])}const c=a(p,[["render",l]]);export{E as __pageData,c as default};
