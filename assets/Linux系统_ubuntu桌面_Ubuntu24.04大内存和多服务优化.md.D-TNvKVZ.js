import{_ as a,c as i,o as n,ag as e}from"./chunks/framework.DWdSXOaE.js";const r=JSON.parse('{"title":"Ubuntu24.04大内存和多服务优化","description":"","frontmatter":{},"headers":[],"relativePath":"Linux系统/ubuntu桌面/Ubuntu24.04大内存和多服务优化.md","filePath":"Linux系统/ubuntu桌面/Ubuntu24.04大内存和多服务优化.md","lastUpdated":1724812253000}'),t={name:"Linux系统/ubuntu桌面/Ubuntu24.04大内存和多服务优化.md"};function p(l,s,o,c,d,u){return n(),i("div",null,[...s[0]||(s[0]=[e(`<h1 id="ubuntu24-04大内存和多服务优化" tabindex="-1">Ubuntu24.04大内存和多服务优化 <a class="header-anchor" href="#ubuntu24-04大内存和多服务优化" aria-label="Permalink to &quot;Ubuntu24.04大内存和多服务优化&quot;">​</a></h1><p>参考文档：</p><p><a href="https://askubuntu.com/questions/1049058/how-to-increase-max-open-files-limit-on-ubuntu-18-04" target="_blank" rel="noreferrer">https://askubuntu.com/questions/1049058/how-to-increase-max-open-files-limit-on-ubuntu-18-04</a></p><p>如果你的电脑开了Docker部署了不少容器，并且安装了各种系统服务， 可以使用如下的优化方案来优化Ubuntu系统。</p><h2 id="优化内核参数" tabindex="-1">优化内核参数: <a class="header-anchor" href="#优化内核参数" aria-label="Permalink to &quot;优化内核参数:&quot;">​</a></h2><p>主要是保证系统能有足够的进程数量，避免进程被杀。允许打开更多文件。</p><p>查看当前限制:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ulimit</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -a</span></span></code></pre></div><h2 id="这是我改好的" tabindex="-1">这是我改好的 <a class="header-anchor" href="#这是我改好的" aria-label="Permalink to &quot;这是我改好的&quot;">​</a></h2><div class="language-text vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>real-time non-blocking time  (microseconds, -R) unlimited</span></span>
<span class="line"><span>core file size              (blocks, -c) 0</span></span>
<span class="line"><span>data seg size               (kbytes, -d) unlimited</span></span>
<span class="line"><span>scheduling priority                 (-e) 0</span></span>
<span class="line"><span>file size                   (blocks, -f) unlimited</span></span>
<span class="line"><span>pending signals                     (-i) unlimited</span></span>
<span class="line"><span>max locked memory           (kbytes, -l) unlimited</span></span>
<span class="line"><span>max memory size             (kbytes, -m) unlimited</span></span>
<span class="line"><span>open files                          (-n) 524288</span></span>
<span class="line"><span>pipe size                (512 bytes, -p) 8</span></span>
<span class="line"><span>POSIX message queues         (bytes, -q) 819200</span></span>
<span class="line"><span>real-time priority                  (-r) 0</span></span>
<span class="line"><span>stack size                  (kbytes, -s) unlimited</span></span>
<span class="line"><span>cpu time                   (seconds, -t) unlimited</span></span>
<span class="line"><span>max user processes                  (-u) unlimited</span></span>
<span class="line"><span>virtual memory              (kbytes, -v) unlimited</span></span>
<span class="line"><span>file locks                          (-x) unlimited</span></span></code></pre></div><h2 id="修改限制" tabindex="-1">修改限制 <a class="header-anchor" href="#修改限制" aria-label="Permalink to &quot;修改限制&quot;">​</a></h2><p>编辑文件 <code>/etc/security/limits.conf</code></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nano</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/security/limits.conf</span></span></code></pre></div><p>增加,表示所有用户除了root不限制这些</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">       -       nofile  unlimited</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">       -       nproc   unlimited</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">       -       stack   unlimited</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">       -       memlock unlimited</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">       -       sigpending unlimited</span></span></code></pre></div><h2 id="配置pam-limits-so" tabindex="-1">配置pam_limits.so <a class="header-anchor" href="#配置pam-limits-so" aria-label="Permalink to &quot;配置pam_limits.so&quot;">​</a></h2><p><code>pam_limits.so</code> 是 Linux 等类 Unix 操作系统中的一个 PAM（可插入身份验证模块）模块。PAM 系统负责管理与身份验证相关的任务，比如登录、设置用户环境和处理密码更改等。</p><p><code>pam_limits.so</code> 模块的主要作用是对用户会话强制执行资源限制。这些资源限制包括：</p><ol><li><strong>最大打开文件数</strong>：限制用户可以打开的文件描述符数量。</li><li><strong>最大核心文件大小</strong>：限制用户生成的核心转储文件的大小。</li><li><strong>CPU 时间</strong>：限制用户可以使用的 CPU 时间量。</li><li><strong>最大内存使用量</strong>：限制用户可以使用的内存大小。</li></ol><p>通过在 PAM 配置文件中使用 <code>session required pam_limits.so</code>，系统会在用户登录时应用这些资源限制。这些限制通常配置在 <code>/etc/security/limits.conf</code> 文件或 <code>/etc/security/limits.d/</code> 目录中的配置文件中。</p><p>将这个模块添加到 <code>/etc/pam.d/common-session</code> ,<code>/etc/pam.d/common-session-noninteractive</code> 文件中，用于登陆的时候加载配置文件中的限制，如下所示：</p><div class="language-text vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>session required pam_limits.so</span></span></code></pre></div>`,22)])])}const m=a(t,[["render",p]]);export{r as __pageData,m as default};
