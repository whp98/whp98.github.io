import{_ as i,c as a,o as n,ag as h}from"./chunks/framework.8SQNO8WI.js";const F=JSON.parse('{"title":"mysql统一全库字符集和排序规则","description":"","frontmatter":{},"headers":[],"relativePath":"数据库/Mysql数据库/mysql统一全库字符集和排序规则.md","filePath":"数据库/Mysql数据库/mysql统一全库字符集和排序规则.md","lastUpdated":1725501067000}'),l={name:"数据库/Mysql数据库/mysql统一全库字符集和排序规则.md"};function k(t,s,p,E,e,d){return n(),a("div",null,[...s[0]||(s[0]=[h(`<h1 id="mysql统一全库字符集和排序规则" tabindex="-1">mysql统一全库字符集和排序规则 <a class="header-anchor" href="#mysql统一全库字符集和排序规则" aria-label="Permalink to &quot;mysql统一全库字符集和排序规则&quot;">​</a></h1><h2 id="修改原因" tabindex="-1">修改原因 <a class="header-anchor" href="#修改原因" aria-label="Permalink to &quot;修改原因&quot;">​</a></h2><p>字符集不统一会导致索引失效</p><p>可以通过下面的语句验证是否是字符集和排序规则导致的问题，可以尝试把字段设置一下字符集和排序规则</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 单表</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SELECT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> table_name </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">WHERE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> field_name </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">collate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> utf8mb4_0900_ai_ci </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;值&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 关联表</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SELECT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> table_name1 A</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  left join</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> table_name2 B </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">on</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> A</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  collate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> utf8mb4_0900_ai_ci </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> B</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">id</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">WHERE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> field_name </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;值&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div><h2 id="批量修改数据库字符集" tabindex="-1">批量修改数据库字符集 <a class="header-anchor" href="#批量修改数据库字符集" aria-label="Permalink to &quot;批量修改数据库字符集&quot;">​</a></h2><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 批量修改数据库字符集</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- ALTER DATABASE db_name CHARACTER SET utf8mb4 COLLATE utf8mb4_bin;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SELECT</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> CONCAT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;ALTER DATABASE &#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, SCHEMA_NAME, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39; CHARACTER SET utf8mb4 COLLATE utf8mb4_bin;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;sql_str&#39;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> information_schema.</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`SCHEMATA\`</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">WHERE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> DEFAULT_CHARACTER_SET_NAME RLIKE </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;utf8mb4&#39;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  AND</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> SCHEMA_NAME </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">IN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;db_name&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><h2 id="批量修改表字符集" tabindex="-1">批量修改表字符集 <a class="header-anchor" href="#批量修改表字符集" aria-label="Permalink to &quot;批量修改表字符集&quot;">​</a></h2><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 批量修改表字符集</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- ALTER TABLE \`db_name\`.\`table\` CHARACTER SET utf8mb4 COLLATE utf8mb4_bin;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SELECT</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> CONCAT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;ALTER TABLE \`&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, TABLE_SCHEMA, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;\`.\`&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, TABLE_NAME,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">              &#39;\` CHARACTER SET utf8mb4 COLLATE utf8mb4_bin;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">AS</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sql_str</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> information_schema.</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`TABLES\`</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">WHERE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> TABLE_SCHEMA </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">IN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SELECT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> SCHEMA_NAME</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                       FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> information_schema.</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`SCHEMATA\`</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                       WHERE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> DEFAULT_CHARACTER_SET_NAME RLIKE </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;utf8mb4&#39;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                         AND</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> SCHEMA_NAME </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">IN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;db_name&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  AND</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> TABLE_TYPE </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;BASE TABLE&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div><h2 id="批量修改字段字符集和排序规则" tabindex="-1">批量修改字段字符集和排序规则 <a class="header-anchor" href="#批量修改字段字符集和排序规则" aria-label="Permalink to &quot;批量修改字段字符集和排序规则&quot;">​</a></h2><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 批量修改字段字符集和排序规则</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- ALTER TABLE db_name.table_name MODIFY COLUMN column_name varchar(30) CHARACTER SET utf8mb4 COLLATE utf8mb4_bin NOT NULL COMMENT &#39;注释&#39;;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SELECT</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> CONCAT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;ALTER TABLE &#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, TABLE_SCHEMA, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;.&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, TABLE_NAME, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39; MODIFY COLUMN &#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, COLUMN_NAME, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39; &#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, COLUMN_TYPE,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">              &#39; CHARACTER SET utf8mb4 COLLATE utf8mb4_bin&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39; &#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">IF</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(IS_NULLABLE </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;NO&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;NOT NULL&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;NULL&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">              IF</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ISNULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(COLUMN_DEFAULT), </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">CONCAT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39; DEFAULT \\&#39;&#39;, COLUMN_DEFAULT, &#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">\\</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)),</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">              IF</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ISNULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(COLUMN_COMMENT), </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">                 CONCAT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39; COMMENT \\&#39;&#39;, replace(COLUMN_COMMENT, &#39;&#39;&#39;&#39;, &#39;&quot;&#39;), &#39;\\&#39;;&#39;))) AS &#39;sql_str&#39;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">FROM information_schema.\`COLUMNS\`</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">WHERE TABLE_SCHEMA IN (SELECT SCHEMA_NAME</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                       FROM information_schema.\`SCHEMATA\`</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                       WHERE DEFAULT_CHARACTER_SET_NAME RLIKE &#39;utf8mb4&#39;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                         AND SCHEMA_NAME IN (&#39;db&#39;))</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  and TABLE_NAME in (select TABLE_NAME</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                     from information_schema.\`TABLES\`</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                     where TABLE_TYPE = &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">BASE </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">TABLE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                       AND TABLE_SCHEMA IN (&#39;db&#39;))</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  and (COLLATION_NAME RLIKE &#39;utf8mb4_0900_ai_ci&#39; or COLLATION_NAME RLIKE &#39;utf8_general_ci&#39;);</span></span></code></pre></div><h2 id="有外建的表需要关闭外键约束关闭后修改" tabindex="-1">有外建的表需要关闭外键约束关闭后修改 <a class="header-anchor" href="#有外建的表需要关闭外键约束关闭后修改" aria-label="Permalink to &quot;有外建的表需要关闭外键约束关闭后修改&quot;">​</a></h2><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SET</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> FOREIGN_KEY_CHECKS</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 执行修改</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SET</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> FOREIGN_KEY_CHECKS</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 执行完之后，重新开启外键约束</span></span></code></pre></div>`,13)])])}const g=i(l,[["render",k]]);export{F as __pageData,g as default};
